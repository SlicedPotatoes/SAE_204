-- Creating tables
CREATE TABLE SensorRecalibration(
    sensorid int REFERENCES sensor NOT NULL,
    timestamp timestamp NOT NULL,
    PRIMARY KEY (sensorid, timestamp)
);

-- Adding "Commissioning" and "Disposal" colum to sensor
ALTER TABLE sensor ADD COLUMN Commissioning timestamp;
ALTER TABLE sensor ADD COLUMN Disposal timestamp;

-- Adding a commissioning date for existing sensors
UPDATE sensor
SET Commissioning = '2022-12-31 23:00:00';

-- Adding not null constraint on column "Commissioning"
ALTER TABLE sensor
ALTER COLUMN Commissioning SET NOT NULL,
ADD CONSTRAINT disposal_gt_commissioning CHECK(Disposal IS NULL OR Disposal > Commissioning);

-- Adding sensors for testing
INSERT INTO Sensor
VALUES (8, 'A', make_interval(secs => 5), 7, '1', '2022-12-31 23:00:00', null),
       (9, 'A', make_interval(secs => 5), 7, '2', '2022-12-31 23:00:00', null),
       (10, 'A', make_interval(secs => 5), 7, '3', '2022-12-31 23:00:00', '2023-09-28 08:00:00'),
       (11, 'A', make_interval(secs => 5), 7, '4', '2022-12-31 23:00:00', null),
       (12, 'A', make_interval(secs => 5), 7, '5', '2022-12-31 23:00:00', null),
       (13, 'A', make_interval(secs => 5), 8, '6', '2022-12-31 23:00:00', '2023-08-24 08:00:00'),
       (14, 'A', make_interval(secs => 5), 8, '7', '2022-12-31 23:00:00', '2024-02-12 08:00:00'),
       (15, 'A', make_interval(secs => 5), 8, '8', '2022-12-31 23:00:00', '2023-08-24 08:00:00'),
       (16, 'A', make_interval(secs => 5), 8, '9', '2022-12-31 23:00:00', '2024-02-12 08:00:00'),
       (17, 'A', make_interval(secs => 5), 8, '10', '2022-12-31 23:00:00', '2023-08-24 08:00:00');

-- Adding Recalibration
INSERT INTO SensorRecalibration
VALUES (8, '2023-06-26 08:00:00'), (8, '2024-02-03 08:00:00'),
       (8, '2024-09-24 08:00:00'), (8, '2025-04-02 08:00:00'),

       (9, '2023-08-24 08:00:00'), (9, '2024-02-16 08:00:00'),
       (9, '2024-10-01 08:00:00'), (9, '2025-03-03 08:00:00'),

       (10, '2023-02-16 08:00:00'), (10, '2024-04-10 08:00:00'),
       (10, '2024-06-14 08:00:00'), (10, '2025-08-07 08:00:00'),

       (11, '2023-07-13 08:00:00'), (11, '2024-01-24 08:00:00'),
       (11, '2024-09-12 08:00:00'), (11, '2025-04-10 08:00:00'),

       (12, '2023-05-13 08:00:00'), (12, '2023-12-16 08:00:00'),
       (12, '2024-06-01 08:00:00'), (12, '2025-01-03 08:00:00'),

       (13, '2023-01-06 08:00:00'), (13, '2023-03-26 08:00:00'),
       (13, '2023-05-01 08:00:00'), (13, '2023-07-24 08:00:00'),

       (14, '2023-01-13 08:00:00'), (14, '2023-02-14 08:00:00'),
       (14, '2023-04-01 08:00:00'), (14, '2023-05-25 08:00:00'),
       (14, '2023-07-01 08:00:00'), (14, '2023-08-20 08:00:00'),
       (14, '2023-10-11 08:00:00'), (14, '2023-12-01 08:00:00'),
       (14, '2024-02-11 08:00:00'),

       (15, '2023-02-03 08:00:00'), (15, '2023-04-16 08:00:00'),
       (15, '2023-06-01 08:00:00'), (15, '2023-08-22 08:00:00'),

       (16, '2023-01-19 08:00:00'), (16, '2023-03-10 08:00:00'),
       (16, '2023-04-26 08:00:00'), (16, '2023-06-12 08:00:00'),
       (16, '2023-07-19 08:00:00'), (16, '2023-09-02 08:00:00'),
       (16, '2023-10-20 08:00:00'), (16, '2023-12-12 08:00:00'),
       (16, '2024-02-08 08:00:00'),

       (17, '2023-02-04 08:00:00'), (17, '2023-04-16 08:00:00'),
       (17, '2023-06-01 08:00:00'), (17, '2023-08-21 08:00:00');